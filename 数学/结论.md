## 组合数学

### 组合数

$n$ 个物品取 $m$ 个，不计顺序

+ $C(n,m)=\frac{n!}/{m!(n-m)!}$ 
+ $C(n,m)=C(n-1,m)+C(n-1,m-1)$ 
+ 乘法逆元+费马小定理： $C(n,m)=n!\times[(m!)^{-1}]\times [(n-m)!]^{-1}\ (mod\ p)$
+ Lucas定理： $C(n,m)\%p=C(n/p,m/p)\times C(n\%p,m\%p)\%p$   
  + 这里好处是可以递归
+ 范德蒙卷积公式： $\sum\limits_{k=0}^m C(m_1,k)\times C(m_2,n-k)=C(m_1+m_2,n)$
  + $C(2n,n)=C(n,0)^2+C(n,1)^2+\cdots +C(n,n)^2$
+ 二项式系数具有单峰对称性

#### 常用结论

$n$ 个球放进 $m$ 个盒，根据球是否相同，盒是否相同，盒是否非空，共 $8$ 种可能

+ 球相同，盒相同，盒非空：不会，很难，$p(n,m)$ 即总和为 $n$，恰好 $m$ 个数相加的拆分数
+ 球相同，盒相同，盒可空：$p(n)$ - 拆分数
+ 球相同，盒不同，盒非空：$C(n-1,m-1)$
+ 球相同，盒不同，盒可空：$C(n+m-1,m-1)$
+ 球不同，盒相同，盒非空：$S(n,m)$ - 第二类斯特林数
+ 球不同，盒相同，盒可空：$S(n,1)+\cdots +S(n,m)$
+ 球不同，盒不同，盒非空：$S(n,m)\cdot m!$
+ 球不同，盒不同，盒可空：$m^n$

$n$ 种元素（每种足够多）选 $m$ 个：$C(n+m-1,m)$

### 排列数

$n$ 个物品取 $m$ 个，记顺序：$P(n,m)=\frac{n!}{(n-m)!}=C(n,m)\times m!$

### 错排数

全排列中满足 $a[i]!=i$ 的方案数：$D(1)=0,D(2)=1,D(n)=(n-1)\cdot (D(n-2)+D(n-1))$

### 鸽巢原理

$n+1$ 个物体放进 $n$ 个盒子

+ 变形1：$m$ 个正整数 $a[1],\cdots ,a[m]$，存在$0\le i<j\le m$，使得$(a[i+1]+a[i+2]+...+a[j])\ |\ m$
  + 证明：做前缀和 $s$，$(a[i+1]+\cdots +a[j])\ |\ m$ 当且仅当 $s[j]-s[i]\ |\ m$，即$s[j]\equiv s[i]\ (mod\  m)$。其中 $s$ 有 $m+1$ 个不同取值，鸽巢原理套上去。
+ 变形2：$n^2+1$ 个数，要么存在长度是 $n+1$ 的最长上升子序列，要么存在长度是 $n+1$ 的最长下降子序列。
  + 证明：（类似反证）不妨假设里面没有长度超过 $n+1$ 的 LIS 和 LCS。设以 $a[i]$ 结尾的 LIS 长度是 $f[i]$,$1\le f[i]\le n$，那么 $n^2+1$ 个 $f[i]$ 中至少有一个值 $1\le k\le n$ 出现至少 $n+1$ 次。设这 $n+1$ 个数按顺序是 $b[1],\cdots, b[n+1]$。其中任意 $1\le t\le n+1$，$f[b[t]]=k$。那么$a[b[1]],a[b[2]],\cdots,a[b[n+1]]$ 一定递减（否则 $f[b[t]]$ 不是 $n$），那么存在长度是 $n+1$ 的 LCS。

### 数列

#### 斐波那契数列

$f[0]=0,f[1]=1,f[n]=f[n-1]+f[n-2](n\ge 2)$

+ 部分和：$S_n = f[0]+f[1]+...+f[n] = f[n+2]-1$ 数学归纳法可证，矩阵快速幂可求
+ 显式解： $f[n]=\frac{1}{\sqrt5}[(\frac{1+\sqrt5}{2})^n-(\frac{1-\sqrt5}{2})^n]$
+ 定义二元组 $T(a,b)=(1/2)\cdot a+(\sqrt5/2)\cdot b$，则可以用两个整数表示公式里奇异部分
  + $T(a,b)+T(c,d)=T(a+c,b+d)$
  + $T(a,b)\cdot T(c,d)=T((a\cdot c+5\cdot b\cdot d)/2,(a\cdot d+b\cdot c)/2)$，数学归纳法可证里面除 $2$ 之后还是整数
+ $f[n]=C(n-1,0)+C(n-2,1)+C(n-3,2)+\cdots+C(n-t,t-1)$ $=$ $\sum\limits_{k=0}^n C(n-k-1,k),t=\left \lfloor \frac{n-1}{2}\right \rfloor$。证明右边也满足 $F(n)=F(n-1)+F(n-2)$ 即可

#### 特征根

如果有递推关系 $f[n]=a[1]\cdot f[n-1]+a[2]\cdot f[n-2]+\cdots +a[k]\cdot f[n-k]$，解特征根方程：$x^k-a[1]\cdot x^(k-1)-a[2]\cdot x^(k-2)+\cdots +(-a[k])=0$

#### 卡特兰数

$f[n]=\frac{C(2n,n)}{n+1}=\sum\limits_{k=0}^{n-1} f[k]\cdot f[n-1-k]=f[n-1]\cdot \frac{4n-2}{n+1}$

直接算用第一个，打表用第三个，奇特的时间空间复杂度第二个（基本是不可能的）

**应用：** 

+ 火车进出站问题
+ n 对括号构成的合法序列
+ 含 n 个叶节点的满二叉树个数
+ n+1 条边的三角剖分方案数
+ 格点中从 (0,0) 走到 (n,n) 的方案数（只走主对角线下方）

拟卡特兰数 $g[n]=n!\cdot f[n]$（为了去掉分母）$g[n]=(4n-6)\cdot g[n-1]$

**应用：** n 个数的无序乘法方案

#### 斯特林数

##### 第一类斯特林数

把 p 个对象排成 k 个非空循环排列的方案（p 个分成 k 个环，每个环非空）

$s[p][0]=0,s[p][p]=1,s[p][k]=(p-1)\cdot s[p-1][k]+s[p-1][k-1]$

##### 第二类斯特林数

把 p 个对象排成 k 个不可区分的盒子并且没有空盒子的方案（n 个分成 k 堆，每堆非空） 

$S[0][0]=1,S[p][0]=0,S[p][p]=1,S[p][k]=k\cdot S[p-1][k]+S[p-1][k-1]$

#### 贝尔数

把 n 个元素划分到 1~n 个集合内的方案数之和，即 n 个元素的集合划分方案数，根据定义显然贝尔数就是第二类斯特林数之和：

+ $B[0]=1,B[1]=1,B[x]=\sum\limits_{k=1}^x S[x][k]$
  + $O(n^2)$ 递推：$B[n]=\sum\limits_{k=0}^{n-1}C(n-1,k)\cdot B[k]$
  + 取模 p 意义下，$B[n+p]=B[n]+B[n+1]\ (mod\ p)$
    + 可以做 $O(p^3)$ 的矩阵快速幂转移 $B[ip]\cdots B[ip+p-1]\to B[(i+1)p]\cdots B[(i+1)p+p-1]$

#### 拆分数

把一个数拆成一个或多个不增数字之和的方案数。如7=3+2+2，做法是 $O(n\sqrt n)$ 筛正五边形数然后递推 $p(0)=1,p(x)=p(x-1)+p(x-2)-p(x-5)-p(x-7)$

#### 其他结论

+ $gcd(a^{b_i}-c^{d_i})=a^{gcd(b_i)}-c^{gcd(d_i)}$
+ $gcd(f_x,f_y)=f_{gcd(x,y)}$，其中 $f$ 为满足斐波那契性质的数列

### Polya定理

> **Burnside 引理：** 
>
> 等价类的个数为 $= \frac{c_1(a_1)+c_1(a_2)+\cdots c_1(a_n)}{|G|}$，竞赛中使用没有 polya 普遍

设 $G$ 是 $p$ 个对象的一个置换群，用 $k$ 种颜色去染这 $p$ 个对象，若一种染色方案在群 $G$ 的作用下变为另一种方案，则这两个方案当作是同一种方案，这样的不同染色方案数为： $L=\frac{1}{|G|}\times\sum k^{C(f)},\ f\in G$，其中 $C(f)$ 为循环节，$|G|$ 表示群的置换方法数。

- 对于有 $n$ 个位置的手镯，有 $n$ 种旋转置换和 $n$ 种翻转置换，那么

  - 对于旋转置换，$C(f_i)=gcd(n,i)$，其中 $i$ 表示一次转过 $i$ 颗宝石， $i=0$ 时 $c=n$；

  - 对于翻转置换，如果 $n$ 为偶数，则

    - 有 $\frac{n}{2}$ 个置换 $C(f_1)=\frac{n}{2}$
    - 有 $\frac{n}{2}$ 个置换 $C(f_2)=\frac{n}{2}+1$

    如果 $n$ 为奇数，那么 $C(f)=\frac{n}{2}+1$

一般循环置换的代码是：

```c++
int ans = 0;
for(int i=0;i<n;i++) {
	ans += a[gcd(n,i)];
}
ans /= n;
```



## 原根

**定义：** 设 $m>1$，$gcd(a,m)=1$，使得 $a^d\equiv 1(mod\ m)$ 成立的最小的正整数 $d$ 为 $a$ 对模 $m$ 的阶，记为 $\delta_m(a)$ ，如果 $\delta_m(a)=\varphi(m)$ 则称 $a$ 是模 $m$ 的原根。

**定理：** 如果 $m>1$，$gcd(a,m)=1$，正整数 $d$ 满足 $a^d\equiv 1(mod\ m)$ 则 $\delta_m(a)$ 整除 $d$。

**定理：** 模 $m$ 有原根的充要条件是 $m=2,4,\cdots,p^n,2\cdot p^n$，其中 $p$ 是奇质数，且 $n$ 是任意正整数。

**定理：** 如果模 $m$ 有原根，那么它一定有 $\varphi(\varphi(m))$ 个原根。

**定理：** 如果 $p$ 是素数，那么一定有原根，并且个数为 $\varphi(p-1)$。

求模 $p$ 素数原根方法：对 $p-1$ 素因子分解，即 $p-1=p_1^{a_1}p_2^{a_2}\cdots p_k^{a_k}$，如果恒有 $g^{\frac{p-1}{p_i}}\neq 1(mod\ p)$ 那么 $g$ 就是原根（合数则把 $p-1$ 换成 $\varphi(p)$ 即可）
